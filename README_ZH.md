# XRPMG 项目说明文档

## 项目概述
**XRPMG（XAJ-RAG-MAML-PGRKU coupled model）** 是一个通用且高度集成的学习框架，专注于复杂流域的水文时间序列分析与预测。  

该框架通过 **PGRKU 模型** 将数据驱动学习与物理约束相结合；采用 **元学习（MAML）策略** 增强跨流域的泛化能力，并引入 **检索增强生成（RAG）机制** 动态集成相关历史信息，从而在极端事件（如洪水期）中保持较高预测精度。  

---

## 主要功能
- **混合学习架构**：结合数据驱动的深度学习与物理元学习，处理复杂的非线性水文过程。  
- **元学习策略**：采用 MAML 算法，使模型能够快速适应未见过的流域数据，显著提升泛化能力。  
- **物理约束集成**：在模型中嵌入物理定律和水文过程知识，确保预测结果符合水力学原则。  
- **检索增强生成**：动态检索历史数据/知识库信息，为模型提供关键上下文。  
- **特征解释功能**：提供基于 SHAP 的解释工具，分析模型预测背后的特征重要性。  

---

## 技术架构

### 核心组件
1. **PGRKU 预测模型（`PGRKUPredictor`）**  
   - 捕捉时间序列中的复杂依赖关系  
   - 融合物理约束  
   - 专为水文预测任务优化  

2. **元学习模块（MAML Module）**  
   - 实现模型无关的元学习策略  
   - 支持新任务快速适应  

3. **检索增强模块（RAG Module）**  
   - 从历史数据/知识库中检索相关信息  
   - 将检索结果与输入结合，提升预测准确性  

4. **数据预处理模块**  
   - 标准化  
   - 缺失值填充  
   - 特征工程  

5. **分析与可视化模块**  
   - 提供 SHAP 等事后解释工具  

---

## 项目结构
```bash
├── Config/                     # 配置文件目录
├── src/                        # 源代码目录
│   ├── analyzer/               # 分析器模块
│   ├── data/                   # 数据处理模块
│   ├── model/                  # 模型定义
│   ├── trainer/                # 训练逻辑
│   └── utils/                  # 工具类
├── XAJ/                        # XAJ 模型相关代码
├── README.md                   # 项目说明文档
├── config_schema.json          # 配置文件模式
└── config_gui.py               # GUI 配置窗口
```
## 安装与依赖
请使用以下命令安装依赖：
```bash
pip install torch numpy pandas scikit-learn shap faiss-cpu
```

## 配置指南

### 配置文件结构
配置文件位于 `Config/` 目录下，采用 **YAML** 格式。  
`config_schema.json` 用于验证配置文件格式。  

主要部分包括：  
- **data**：数据集配置块  
  - `datasets`: 数据集列表（`name`、`processors`、`path`、`target_column`）  
  - `processors`: 数据预处理步骤及参数  
  - `window`: 滑动窗口大小  
  - `test_size`: 测试集比例  

- **models**：模型配置  
  - 每个模型由 `name` 定义  
  - 包含 `enabled` 和 `type` 字段  
  - 可选 `params`: 模型超参数  
  - 可选 `trainer`: 训练配置（如交叉验证 `cv`、评估指标 `scoring`）  

- **analyzers**：实验后分析工具配置  

- **output**：实验结果输出路径（`analysis_result_path`、`data_result_path`）  

---

## 使用说明

1. **准备数据**  
   将时间序列数据保存为 **CSV 文件**，并确保包含所有相关特征列和目标列。  

2. **配置实验**  
   修改 `Config/test.yaml` 文件，或使用提供的 GUI 工具：  
   ```bash
   python config_gui.py

3. **运行实验**
   
   执行主脚本：
   
   ```bash
   python -m src.run
   ```
## 技术创新
- **物理知识与深度学习耦合**  
  在 PGRKU 模型中引入物理约束，使预测结果更具解释性和物理合理性。  

- **自适应泛化能力**  
  利用 MAML 元学习方法，使模型能够快速适应新流域，减少对大量历史数据的依赖。  

- **上下文感知预测**  
  借助 RAG 模块动态检索相关历史信息，有效应对洪水等极端事件。  

---

## 性能指标
框架支持多维度评估指标，包括：  

- **预测精度**：MAE、MSE、RMSE、R²  
- **水文指标**：NSE、KGE  
- **物理约束满足度**：约束违反惩罚分数  

---

## 未来增强
- **多源数据集成**：融合天气预报、卫星遥感等外部数据源  
- **不确定性量化**：提供预测结果的不确定性评估方法  
- **强化学习优化**：探索高级 RL 算法以提升长期调度决策能力  

---

## 联系方式
由于工程参数保密和数据安全考虑，本说明文档仅提供核心算法框架。  

如需获取完整的源代码、数据集和技术文档，请联系：  
📧 **kjc2005105@126.com**
